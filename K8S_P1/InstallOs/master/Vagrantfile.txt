# -- mode ruby --
# vi set ft=ruby 
# Tạo máy ảo từ box ubuntu, gán địa chỉ IP, đặt hostname, gán 2GB bộ nhớ, 1 cpus  
Vagrant.configure(2) do config
    config.vm.box = genericubuntu2004
    config.vm.network private_network, ip 192.168.10.100
    config.vm.hostname = master
    config.vm.provider virtualbox do vb
        vb.name = master
        vb.cpus = 2
        vb.memory = 2048
    end
    # Chạy file install-docker-kube.sh sau khi nạp Box
    config.vm.provision shell, path ...install-docker-kube.sh
    # Chạy các lệnh shell
    config.vm.provision shell, inline -SHELL
        # enable ssh
        sed -i 's^PasswordAuthentication .PasswordAuthentication yes' etcsshsshd_config
        echo 'PermitRootLogin yes'  etcsshsshd_config
        sudo systemctl reload sshd
        # Đặt pass 123 có tài khoản root và cho phép SSH
        echo -e 123n123  passwd root devnull 2&1
        echo export TERM=xterm  etcbash.bashrc
        echo Update etchosts file
        sudo cat etchostsEOF
            192.168.10.100   master
            192.168.10.101   worker1
            192.168.10.102   worker2
        EOF
    SHELL
end